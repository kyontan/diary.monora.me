# 2018-04-22 (Sun)

## 天気

- 晴れ
  - 最高の春の1日
  - 春眠暁を覚えず

## 時系列

- 16:30: 起床
- 17:40 - 19:20: 外食
- 20:00 - 21:00: テレビ観てた
- 23:00 - 24:20: BigQuery と戯れる
- 25:00 - 25:45: 某プロジェクト
- 27:00 - 27:30: minikube

## 雑感

### 起床

適度に暖かい日差しのせいでついつい寝すぎた

### 外食

近所に最近できた店に行ったけど体験が色々アレだった。つらい。

客席が20席程度の小規模な居酒屋でタッチパネル式の注文を導入するのはペイするのだろうか。
というのはともかくとしてあのどこでも見かけるソリューションのUI/UXはゴミだと思う。
まあそれだけじゃないけど……

### テレビ観てた

なんかK-POPの歌手と声マネが得意な人をブラインドで隠して誰が本人か当てるやつ。親がNetflix?で観てたので眺めていた。
それはともかく国民的妹っていうフレーズは強い。

### BigQuery と戯れる

こんな記事があり: [BigQuery beyond SQL and JS: Running C and Rust code at scale](https://medium.com/@hoffa/bigquery-beyond-sql-and-js-running-c-and-rust-code-at-scale-33021763ee1f)

普通に(?) BigQuery の UDF (User Defined Function) で WASM 動いたわ〜 みたいな話なんですけれど、実はこれは Legacy SQL を使っている。

なぜかというと WebAssembly の初期化処理は非同期であり、Legacy SQL の UDF は非同期に結果を返せる仕組みになっているからである。
Standard SQL では同期的に結果を返さないといけない。

とはいえ中身 node っぽいし ES7 の async/await 使えるでしょ〜って試していたらハマった。結局無理でした。

StandardSQL の UDF は関数定義が独自記法で、 ES で書けるのは関数のボディのみ。つまりトップレベルが `async` でない `function` なので `await` が使えない。

もしかしたら実は暗黙の `async function` なんじゃね? と言いながら `Promise` を返したらクエリ実行が終わらなくなった。3時間経った今も走っている。

BigQuery の Standard SQL で3時間掛かるクエリを走らせるの、多分一般的な手法では不可能だと思うので優勝した。優勝はこういうときに便利ですね。

一応 BigQuery の実行時間の制限は6時間らしく、多分タイムアウトで殺されるはずである。

1バイトもスキャンしない(=無課金)でコンピュートリソースを虚無に投げることができるので便利。いや、便利ではないな……

### minikube 構築

- ディスク容量が足りないと人は様々な問題を引いて死ぬ
  - ディスク容量足りなくて構築コケるとかありがちだと思うんですけど対処法を示さないまま死ぬってことは意外とないのか……?

### その他

- サービスメッシュとか色々調べてる
  - 調べるだけじゃなくてはよ試せ
  - Docker Hub の CoreOS org みたらやる気がなくて笑った
    - etcd をコンテナに突っ込むなという気持ちを感じるが
    - fleet な……
- Ci-en のやきうぶ全裸プランに入った
  - タコ焼き先生には無限に課金したい
  - https://ci-en.jp/creator/855

## 明日

- 某プロジェクト続き
- 本を読む
